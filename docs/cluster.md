## Redis集群

### 1 Redis集群提供的功能

* 根据用户的请求将数据自动分布到不同的节点
* 整个集群的部分节点失败或者不可达时能够继续处理命令

### 2 Redis中对分布式中若干问题的处理

#### 2.1 数据分片

由于是集群分布式存储数据，需要对数据进行分片，就是业界提到的`Sharding`，中文翻译为`分片`。

Redis没有采用`一致性哈希`，而是引入`hash slots`(哈希槽)的概念。

以三个节点为例：

Redis集群中有16384个槽，每个key通过`CRC16`计算后对16384取模，从而决定应该放到哪个槽中。

* 节点A包含0~5460号槽
* 节点B包含5461~10922号槽
* 节点C包含10923~16383号槽

#### 2.2 主从同步

为了保持集群的高可用，在进行数据分片的同时，需要对每个节点进行备份，即每个节点都需要有两个备节点，以保证在主出现异常时可以正常切换。

因此，生产环境下使用集群模式时，最好使用6个节点：三主三从。

#### 2.3 一致性

同步写与异步写：当客户端向服务端发送写请求时，主会将请求发送给备，在备上执行命令。如果在主执行完成后就给客户端返回结果，之后再异步将命令发送给备，这称为异步写；如果在主执行完成后，将命令发送给备，如果有一半以上的备响应，才给客户端回应，这称为同步写。

Redis基于性能和一致性上的考虑，当前采用的是异步写。

### 3 集群搭建及简单使用

#### 3.1 集群部署

